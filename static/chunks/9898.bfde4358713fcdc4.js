"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9898],{14763:(e,t,n)=>{n.d(t,{Go:()=>s,Qc:()=>u,cM:()=>p,sb:()=>d,wN:()=>c});var i=n(53455),r=n(99776),a=n(80549),o=n(28153);let l={staleTime:6e4,retry:1},s=e=>(0,i.I)({queryKey:["userProfile",e],queryFn:()=>o.Ay.getUserProfileByWallet(e),enabled:!!e,...l}),c=e=>(0,i.I)({queryKey:["userProfile",e],queryFn:async()=>{let t=await o.Ay.getUserProfileByWallet(e);return null==t?void 0:t.userName},enabled:!!e,...l}),d=()=>(0,i.I)({queryKey:["myProfile"],queryFn:()=>o.Ay.getUserProfile(),...l}),u=()=>{let e=(0,r.jE)();return(0,a.n)({mutationFn:e=>o.Ay.updateUser(e),onSuccess:t=>{e.setQueryData(["myProfile"],t)}})},p=()=>{let e=(0,r.jE)();return(0,a.n)({mutationFn:e=>o.Ay.updateUserBackground(e),onSuccess:t=>{e.setQueryData(["myProfile"],t)}})}},28153:(e,t,n)=>{n.d(t,{Ay:()=>l});var i=n(95125),r=n(72378);let a="https://d5ffe0dc8ad8.ngrok-free.app/api",o=()=>{let e=r.A.get("accessToken");return e?{Authorization:"Bearer ".concat(e)}:{}},l={getUserProfile:async()=>(await i.A.get("".concat(a,"/user"),{headers:{...o(),"ngrok-skip-browser-warning":"true"}})).data.data,getUserProfileByWallet:async e=>{let t=r.A.get("account")||"";return(await i.A.get("".concat(a,"/user/get-profile"),{params:{addressWallet:e,myAddressWallet:t||void 0},headers:{...o(),"ngrok-skip-browser-warning":"true"}})).data.data},updateUser:async e=>{let t=new FormData;return t.append("userName",e.userName),t.append("fullName",e.fullName),t.append("bio",e.bio),e.avatar&&t.append("avatar",e.avatar),(await i.A.put("".concat(a,"/user"),t,{headers:{...o(),"ngrok-skip-browser-warning":"true","Content-Type":"multipart/form-data"}})).data.data},updateUserBackground:async e=>{let t=new FormData;return t.append("image",e.image),(await i.A.put("".concat(a,"/user/update-background"),t,{headers:{...o(),"ngrok-skip-browser-warning":"true","Content-Type":"multipart/form-data"}})).data.data},getUserAvatar:e=>"https://res.cloudinary.com/dr6cnnvma/image/upload/v1763370298/".concat(e,".png")}},39898:(e,t,n)=>{n.d(t,{A:()=>eO});var i=n(95155),r=n(12115),a=n(98638),o=n(80317),l=n(41942),s=n(41574),c=n(27855),d=n(50301),u=n(66088),p=n(59300),f=n(75416),h=n(76541),g=n(56116),b=n(83523),m=n(20063),x=n(22591),y=n(11515),w=n(24103),A=n(75265),v=n(2021),j=n(99496),k=n(50355),C=n(74193),I=n(66370),S=n(44517),T=n(51012);let N=e=>{let{open:t,onClose:n,onNext:r,metadata:a}=e;return(0,i.jsxs)(A.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(v.A,{children:"Metadata Preview"}),(0,i.jsx)(j.A,{children:(0,i.jsx)(s.default,{sx:{p:2,bgcolor:"#F5F5F5",borderRadius:2,fontFamily:"monospace",whiteSpace:"pre-wrap",fontSize:"0.85rem",overflowX:"auto"},children:JSON.stringify(a,null,2)})}),(0,i.jsxs)(I.A,{children:[(0,i.jsx)(c.A,{onClick:n,children:"Close"}),(0,i.jsx)(c.A,{onClick:r,variant:"contained",children:"Continue"})]})]})};var F=n(37440);let M=e=>{var t,n,s,d,u,p,f,h,g,b,m,x,y,w;let{open:k,onClose:C,data:T,ownedProduct:N,onConfirm:M}=e,[R,E]=(0,r.useState)(!1),[P,O]=(0,r.useState)(null),L=async()=>{E(!0),O(null);try{await M(),S.Ay.success("Cập nhật NFT tr\xean blockchain th\xe0nh c\xf4ng!"),C()}catch(e){console.error(e),S.Ay.error(e instanceof Error?e.message:"Cập nhật thất bại!")}finally{E(!1)}};if(!T&&!N)return null;let U=null!=(u=null!=(d=null==T?void 0:T.tokenId)?d:Number(null!=(s=null==N?void 0:N.tokenId)?s:0))?u:"N/A",W=null!=(f=null!=(p=null==T?void 0:T.name)?p:null==N?void 0:N.name)?f:"N/A",z=null!=(g=null!=(h=null==T?void 0:T.description)?h:null==N?void 0:N.description)?g:"N/A",B=null!=(x=null!=(m=null!=(b=null==T?void 0:T.tokenURI)?b:null==N||null==(n=N.ownerships)||null==(t=n[0])?void 0:t.tokenURI)?m:null==N?void 0:N.tokenURI)?x:"N/A",_=null!=(w=null!=(y=null==T?void 0:T.price)?y:null==N?void 0:N.price)?w:"N/A";return(0,i.jsxs)(A.A,{open:k,onClose:R?()=>{}:C,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(v.A,{children:"Cập nhật NFT tr\xean Smart Contract"}),(0,i.jsx)(j.A,{children:(0,i.jsxs)(l.A,{spacing:2,children:[(0,i.jsx)(o.A,{children:"Bạn sắp cập nhật NFT đ\xe3 mint với:"}),(0,i.jsxs)(o.A,{children:[(0,i.jsx)("strong",{children:"Token ID:"})," ",U]}),(0,i.jsxs)(o.A,{children:[(0,i.jsx)("strong",{children:"Name:"})," ",W]}),(0,i.jsxs)(o.A,{children:[(0,i.jsx)("strong",{children:"Description:"})," ",z]}),(0,i.jsxs)(o.A,{children:[(0,i.jsx)("strong",{children:"Token URI:"})," ",B]}),(0,i.jsxs)(o.A,{children:[(0,i.jsx)("strong",{children:"Price:"})," ",_," ETH"]}),R&&(0,i.jsxs)(l.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(a.A,{size:20}),(0,i.jsx)(o.A,{children:"Đang xử l\xfd tr\xean blockchain..."})]}),P&&(0,i.jsxs)(o.A,{children:["Giao dịch th\xe0nh c\xf4ng:"," ",(0,i.jsx)(F.A,{href:"https://etherscan.io/tx/".concat(P),target:"_blank",rel:"noopener",children:P})]})]})}),(0,i.jsxs)(I.A,{children:[(0,i.jsx)(c.A,{onClick:C,disabled:R,children:"Hủy"}),(0,i.jsx)(c.A,{onClick:L,variant:"contained",disabled:R,children:R?"Đang cập nhật...":"X\xe1c nhận"})]})]})};var R=n(16836),E=n(43338),P=n(99794),O=n(95704);let L="0xA5A8fD22c7038bc9B43846c898662E8Ab5d47E25";L||console.warn("⚠️ Thiếu biến NEXT_PUBLIC_CONTRACT_ADDRESS trong .env.local");let U=["function mintFullNFT(string nameToken,string tokenURI_,string description,uint256 price) public returns (uint256)","function mintToken(string newTokenURI) public returns (uint256)","function updateNFT(uint256 tokenId,string tokenURI_,uint256 price) public","function sendNFT(address to,uint256 tokenId) public","function burnNFT(uint256 tokenId) public","function getNFTInfo(uint256 tokenId) public view returns (string,string,string,uint256,address,address)","function totalMinted() public view returns (uint256)"];function W(e){let t=e||function(){if(window.ethereum){let e=window.ethereum;return new T.k(e)}let e=O.env.NEXT_PUBLIC_RPC_URL||"https://rpc.zerochain.network";return console.log("\uD83D\uDEF0️ D\xf9ng RPC fallback:",e),new R.FR(e,{name:"PZO",chainId:5080})}();return new E.NZ(L,U,t)}let z={mintFullNFT:async(e,t)=>{let n=W(e);return await n.mintFullNFT(t.nameToken,t.tokenURI,t.description,(0,P.g5)(t.price.toString()))},mintToken:async(e,t)=>{let n=W(e);return(await n.mintToken(t)).wait()},updateNFT:async(e,t,n,i)=>{let r=W(e),a=await r.updateNFT(t,n,(0,P.g5)(i.toString()));return await a.wait(),a},getNFTInfo:async e=>{let t=W(),n=await t.getNFTInfo(e);return{name:n[0],tokenURI:n[1],description:n[2],price:(0,P.ck)(n[3]),creator:n[4],owner:n[5]}}},B=e=>{let{open:t,onClose:n,product:a,onUpdate:o,isMinted:d=!1}=e,u=!!a.isFreeze,p=(0,x.CC)(),[f,h]=(0,r.useState)(a.name),[g,b]=(0,r.useState)(a.description),[m,y]=(0,r.useState)(a.externalLink||""),[w,F]=(0,r.useState)(null),[R,E]=(0,r.useState)([...a.properties]),[P,O]=(0,r.useState)(a.supply||1),[L,U]=(0,r.useState)(a.blockchain||""),[W,B]=(0,r.useState)(a.price),[_,D]=(0,r.useState)(null),[q,K]=(0,r.useState)(!1),[Q,G]=(0,r.useState)(null),[H,V]=(0,r.useState)(!1),{updateNFT:X}=function(){let[e,t]=(0,r.useState)(!1),[n,i]=(0,r.useState)(null),[a,o]=(0,r.useState)(null),l=(0,r.useCallback)(async()=>{if(!window.ethereum)return alert("Please install MetaMask!"),null;let e=new T.k(window.ethereum);return await e.send("eth_requestAccounts",[]),e.getSigner()},[]),s=(0,r.useCallback)(async(e,n,r,a)=>{t(!0),o(null);try{var s;let t=await l();if(!t)throw Error("No signer connected");let o=await z.mintFullNFT(t,{nameToken:e,tokenURI:n,description:r,price:a});return i(null!=(s=o.hash)?s:null),await o.wait(),o}catch(e){e instanceof Error?o(e.message):o("Unknown error occurred")}finally{t(!1)}},[l]),c=(0,r.useCallback)(async e=>{t(!0),o(null);try{let t=await l();if(!t)throw Error("No signer connected");let n=await z.mintToken(t,e);return i(n.transactionHash),n}catch(e){e instanceof Error?o(e.message):o("Unknown error occurred")}finally{t(!1)}},[l]);return{loading:e,txHash:n,error:a,mintFullNFT:s,mintToken:c,updateNFT:(0,r.useCallback)(async(e,n,r)=>{t(!0),o(null);try{let t=await l();if(!t)throw Error("No signer connected");let a=await z.updateNFT(t,e,n,r);return i(a.hash),a}catch(e){return e instanceof Error?o(e.message):o("Unknown error occurred"),null}finally{t(!1)}},[l]),getNFTInfo:(0,r.useCallback)(async e=>{try{return await z.getNFTInfo(e)}catch(e){return e instanceof Error?o(e.message):o("Unknown error occurred"),null}},[])}}();(0,r.useEffect)(()=>{h(a.name),b(a.description),y(a.externalLink||""),F(null),E([...a.properties]),O(a.supply||1),U(a.blockchain||""),B(a.price)},[a]);let Z=async()=>{if(Q)try{if(!window.ethereum)throw Error("Cần kết nối v\xed Web3!");let a=new T.k(window.ethereum),l=await a.getSigner();if(0===Q.tokenId){var e,t,i,r;let a=await z.mintFullNFT(l,{nameToken:Q.name,tokenURI:Q.tokenURI,description:Q.description,price:Number(Q.price)}),s=(null==(r=(await a.wait()).events)||null==(i=r[0])||null==(t=i.args)||null==(e=t.tokenId)?void 0:e.toNumber())||0;S.Ay.success("Mint NFT th\xe0nh c\xf4ng!"),null==o||o(),V(!1),G({...Q,tokenId:s}),n()}else{let e=await X(Q.tokenId,Q.tokenURI,Number(Q.price));await e.wait(),S.Ay.success("Cập nhật NFT tr\xean blockchain th\xe0nh c\xf4ng!"),null==o||o(),V(!1),n()}}catch(e){console.error(e),S.Ay.error(e instanceof Error?e.message:"Cập nhật thất bại!")}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(A.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(160deg, #0f0f0f 0%, #1a0f2b 100%)",border:"1px solid #7a3bff",boxShadow:"0 0 25px rgba(122,59,255,0.6)",p:2}},children:[(0,i.jsx)(v.A,{sx:{color:"#fff",fontWeight:700,textAlign:"center",textShadow:"0 0 6px #7a3bff"},children:d?"Update Minted NFT":"Update / Create NFT"}),(0,i.jsx)(j.A,{children:(0,i.jsxs)(l.A,{spacing:2,pt:2,children:[(0,i.jsx)(k.A,{label:"Name",value:f,onChange:e=>h(e.target.value),fullWidth:!0,disabled:u,sx:{input:{color:"#fff"},label:{color:"#aaa"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#7a3bff"},"&:hover fieldset":{borderColor:"#ff5ca2"},"&.Mui-focused fieldset":{borderColor:"#ff5ca2",boxShadow:"0 0 8px #ff5ca2"}},"& .MuiOutlinedInput-input.Mui-disabled":{color:"#fff","-webkit-text-fill-color":"#B6B6B6",opacity:.8},"& .MuiInputLabel-root.Mui-disabled":{color:"#fff",opacity:1},"& .MuiOutlinedInput-root.Mui-disabled .MuiOutlinedInput-notchedOutline":{borderColor:"#7a3bff"}}}),(0,i.jsx)(k.A,{label:"Description",value:g,onChange:e=>b(e.target.value),fullWidth:!0,multiline:!0,disabled:u,sx:{textarea:{color:"#fff"},label:{color:"#aaa"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#7a3bff"},"&:hover fieldset":{borderColor:"#ff5ca2"},"&.Mui-focused fieldset":{borderColor:"#ff5ca2",boxShadow:"0 0 8px #ff5ca2"}},"& .MuiOutlinedInput-input.Mui-disabled, & .MuiOutlinedInput-input.Mui-disabled textarea":{color:"#fff","-webkit-text-fill-color":"#B6B6B6",opacity:.8},"& .MuiInputLabel-root.Mui-disabled":{color:"#fff",opacity:1},"& .MuiOutlinedInput-root.Mui-disabled .MuiOutlinedInput-notchedOutline":{borderColor:"#7a3bff"}}}),(0,i.jsx)(k.A,{label:"External Link",value:m,onChange:e=>y(e.target.value),fullWidth:!0,disabled:u,sx:{input:{color:"#fff"},label:{color:"#aaa"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#7a3bff"},"&:hover fieldset":{borderColor:"#ff5ca2"},"&.Mui-focused fieldset":{borderColor:"#ff5ca2",boxShadow:"0 0 8px #ff5ca2"}},"& .MuiOutlinedInput-input.Mui-disabled":{color:"#fff","-webkit-text-fill-color":"#B6B6B6",opacity:.8},"& .MuiInputLabel-root.Mui-disabled":{color:"#fff",opacity:1},"& .MuiOutlinedInput-root.Mui-disabled .MuiOutlinedInput-notchedOutline":{borderColor:"#7a3bff"}}}),(0,i.jsxs)(c.A,{variant:"outlined",component:"label",disabled:u,sx:{color:"#fff",borderColor:"#7a3bff","&:hover":{borderColor:"#ff5ca2",boxShadow:"0 0 12px #ff5ca2"},"&.Mui-disabled":{color:"#fff",borderColor:"#7a3bff",opacity:1}},children:["Upload Image",(0,i.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>e.target.files&&F(e.target.files[0])})]}),(0,i.jsx)(s.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:R.map((e,t)=>(0,i.jsx)(C.A,{label:"".concat(e.type,": ").concat(e.name),color:"secondary",size:"small",sx:{border:"1px solid #7a3bff",color:"#fff",background:"rgba(122,59,255,0.1)",textShadow:"0 0 4px #7a3bff"}},t))}),(0,i.jsx)(k.A,{label:"Supply",type:"number",value:P,onChange:e=>O(Number(e.target.value)),fullWidth:!0,disabled:u,sx:{input:{color:"#fff"},label:{color:"#aaa"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#7a3bff"},"&:hover fieldset":{borderColor:"#ff5ca2"},"&.Mui-focused fieldset":{borderColor:"#ff5ca2",boxShadow:"0 0 8px #ff5ca2"}},"& .MuiOutlinedInput-input.Mui-disabled":{color:"#fff","-webkit-text-fill-color":"#B6B6B6",opacity:.8},"& .MuiInputLabel-root.Mui-disabled":{color:"#fff",opacity:1},"& .MuiOutlinedInput-root.Mui-disabled .MuiOutlinedInput-notchedOutline":{borderColor:"#7a3bff"}}}),(0,i.jsx)(k.A,{label:"Blockchain",value:L,onChange:e=>U(e.target.value),fullWidth:!0,disabled:u,sx:{input:{color:"#fff"},label:{color:"#aaa"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#7a3bff"},"&:hover fieldset":{borderColor:"#ff5ca2"},"&.Mui-focused fieldset":{borderColor:"#ff5ca2",boxShadow:"0 0 8px #ff5ca2"}},"& .MuiOutlinedInput-input.Mui-disabled":{color:"#fff","-webkit-text-fill-color":"#B6B6B6",opacity:.8},"& .MuiInputLabel-root.Mui-disabled":{color:"#fff",opacity:1},"& .MuiOutlinedInput-root.Mui-disabled .MuiOutlinedInput-notchedOutline":{borderColor:"#7a3bff"}}}),(0,i.jsx)(k.A,{label:"Price",type:"number",value:W,onChange:e=>B(e.target.value),fullWidth:!0,sx:{input:{color:"#fff",fontWeight:700},label:{color:"#fff"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ff5ca2"},"&.Mui-focused fieldset":{boxShadow:"0 0 10px #ff5ca2"}}}})]})}),(0,i.jsxs)(I.A,{sx:{justifyContent:"center"},children:[(0,i.jsx)(c.A,{onClick:n,sx:{color:"#fff",border:"1px solid #7a3bff","&:hover":{boxShadow:"0 0 12px #7a3bff"}},children:"Close"}),(0,i.jsx)(c.A,{onClick:()=>{if(!u&&(!f.trim()||!g.trim()||!w&&!a.image||!m.trim()||!R.length||!P||!L.trim()||!W))return void S.Ay.error("Vui l\xf2ng điền đầy đủ tất cả c\xe1c th\xf4ng tin NFT!");let e=u?{id:String(a.id),price:W}:{id:String(a.id),name:f.trim(),description:g.trim(),image:null!=w?w:void 0,externalLink:m.trim(),properties:R,supply:P,blockchain:L,price:W,isFreeze:a.isFreeze};p.mutate(e,{onSuccess:e=>{let t=null==e?void 0:e.data,i="string"==typeof t?t:null==t?void 0:t.tokenURI,r=null!=i?i:a.tokenURI;if(!r)return void S.Ay.error("Kh\xf4ng lấy được tokenURI mới!");let l={name:f,description:g,image:w?URL.createObjectURL(w):a.image,external_url:m,attributes:R.map(e=>({trait_type:e.type,value:e.name})),tokenURI:r};u?(S.Ay.success("Cập nhật NFT th\xe0nh c\xf4ng!"),null==o||o(),n()):(D(l),K(!0),G({tokenId:Number(a.tokenId)||0,tokenURI:r,price:W||"0",name:f,description:g}))},onError:e=>{S.Ay.error(e instanceof Error?e.message:"Cập nhật thất bại!")}})},variant:"contained",disabled:p.isPending,sx:{background:"linear-gradient(90deg,#7a3bff,#ff5ca2)",boxShadow:"0 0 12px #ff5ca2","&:hover":{boxShadow:"0 0 20px #ff5ca2"}},children:p.isPending?"Saving...":"Save"})]})]}),_&&(0,i.jsx)(N,{open:q,onClose:()=>K(!1),metadata:_,onNext:()=>(e=>{G({tokenId:Number(a.tokenId),tokenURI:e.tokenURI,price:W||"0",name:e.name,description:e.description}),K(!1),V(!0)})(_)}),Q&&(0,i.jsx)(M,{open:H,onClose:()=>V(!1),data:Q,ownedProduct:a,onConfirm:Z})]})};var _=n(88612),D=n(56942),q=n(9487),K=n(67270);let Q=JSON.parse('[{"inputs":[{"internalType":"string","name":"name_","type":"string"},{"internalType":"string","name":"symbol_","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"_approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),G="0xA5A8fD22c7038bc9B43846c898662E8Ab5d47E25",H="0xe76b09274f7b6681A65975449F9aB3175dd17E51";var V=n(93475);let X=e=>{let{open:t,onClose:n,tokenId:a,defaultPrice:o,product:s}=e,d=new Date,u=new Date(d.getTime()+6e4).toISOString().slice(0,16),p=new Date(d.getTime()+36e5).toISOString().slice(0,16),[f,h]=(0,r.useState)(o),[g,b]=(0,r.useState)("buyNow"),[m,x]=(0,r.useState)(u),[y,C]=(0,r.useState)(p),[N,F]=(0,r.useState)(!1),M=async()=>{if(!N){F(!0);try{let e=Number(f);if(!f||isNaN(e)||e<=0)throw Error("Gi\xe1 phải l\xe0 số hợp lệ lớn hơn 0");if("onAuction"===g&&(!m||!y))throw Error("Vui l\xf2ng chọn ng\xe0y bắt đầu v\xe0 kết th\xfac đấu gi\xe1");if(!window.ethereum)throw Error("Vui l\xf2ng c\xe0i đặt MetaMask");let t=new T.k(window.ethereum),i=await t.getSigner(),r=await i.getAddress(),o=new E.NZ(G,Q,i);if(!await o.isApprovedForAll(r,H)){let e=await o.setApprovalForAll(H,!0);await e.wait()}if((null==s?void 0:s.listingId)&&"onAuction"===g&&(await (0,w.cw)({listingId:s.listingId}),await V.v_.cancelListing(i,s.listingId)),"buyNow"===g){let t=await V.v_.listItem(i,G,a,e),n=function(e){if(!(null==e?void 0:e.logs))return null;let t="ItemListed(uint256,address,address,uint256,uint256)",n=D.id(t),i=new q.KA(["event ".concat(t)]),r=new K.y;for(let t of e.logs)try{var a,o,l,s,c,d;if(!t.topics||0===t.topics.length||t.topics[0]!==n)continue;try{let e=i.parseLog(t);if((null==e?void 0:e.name)==="ItemListed"){let t=null!=(l=null==(o=e.args.listingId)||null==(a=o.toString)?void 0:a.call(o))?l:null;if(t)return t}}catch(e){}if(t.topics.length>=2)try{let e=BigInt(t.topics[1]).toString();if(e)return e}catch(e){}if(t.data&&"0x"!==t.data)try{let e=r.decode(["uint256","address","address","uint256","uint256"],t.data);if((null==e?void 0:e.length)>0)return null!=(d=null==(c=e[0])||null==(s=c.toString)?void 0:s.call(c))?d:null}catch(e){}}catch(e){console.warn("extractListingIdFromReceipt error for one log, continuing",e)}return null}(t);S.Ay.success("NFT đ\xe3 được list! ListingId: ".concat(null!=n?n:"unknown"))}else if("onAuction"===g){let t=Date.parse(m),n=Date.parse(y),r=Math.floor((n-t)/1e3);if(console.log({startTime:m,endTime:y,start:t,end:n,durationSeconds:r}),isNaN(t)||isNaN(n)||r<=0)throw Error("Thời gian đấu gi\xe1 kh\xf4ng hợp lệ");let o=await V.v_.createAuction(i,G,a,e,r),l=function(e){if(!(null==e?void 0:e.logs))return null;let t=new q.KA(["event AuctionCreated(uint256 indexed auctionId, address indexed seller, address indexed nftAddress, uint256 tokenId, uint256 minPrice, uint256 startTime, uint256 endTime)"]);for(let n of e.logs)try{let e=t.parseLog(n);if((null==e?void 0:e.name)==="AuctionCreated")return{auctionId:e.args.auctionId.toString(),seller:e.args.seller,nftAddress:e.args.nftAddress,tokenId:e.args.tokenId.toString(),minPrice:e.args.minPrice.toString(),startTime:e.args.startTime.toString(),endTime:e.args.endTime.toString()}}catch(e){continue}return null}(o);if(!l)throw Error("Kh\xf4ng thể lấy AuctionId từ transaction");S.Ay.success("Auction created! AuctionId: ".concat(l.auctionId)),console.log("Auction info:",l)}n()}catch(t){let e=t instanceof Error?t.message:"Đăng b\xe1n thất bại";S.Ay.error(e),console.error(t)}finally{F(!1)}}};return(0,i.jsxs)(A.A,{open:t,onClose:n,maxWidth:"xs",fullWidth:!0,children:[(0,i.jsx)(v.A,{children:"Đăng b\xe1n NFT"}),(0,i.jsx)(j.A,{children:(0,i.jsxs)(l.A,{spacing:2,children:[(0,i.jsx)(k.A,{label:"Gi\xe1 (ETH)",type:"number",value:f,onChange:e=>h(e.target.value),fullWidth:!0}),(0,i.jsxs)(k.A,{select:!0,label:"Loại b\xe1n",value:g,onChange:e=>b(e.target.value),fullWidth:!0,children:[(0,i.jsx)(_.A,{value:"buyNow",children:"Buy Now"}),(0,i.jsx)(_.A,{value:"onAuction",children:"On Auction"})]}),"onAuction"===g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.A,{label:"Ng\xe0y v\xe0 giờ bắt đầu",type:"datetime-local",value:m,onChange:e=>x(e.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}}),(0,i.jsx)(k.A,{label:"Ng\xe0y v\xe0 giờ kết th\xfac",type:"datetime-local",value:y,onChange:e=>C(e.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]})]})}),(0,i.jsxs)(I.A,{children:[(0,i.jsx)(c.A,{onClick:n,children:"Hủy"}),(0,i.jsx)(c.A,{variant:"contained",onClick:M,disabled:N,children:N?"Processing...":"Sell"})]})]})};var Z=n(90335),J=n(22544),Y=n(86627),$=n(14763),ee=n(74612);function et(e){let{open:t,onClose:n,user:a}=e,{register:o,handleSubmit:s}=(0,J.mN)({defaultValues:{fullName:a.fullName,userName:a.userName,bio:a.bio}}),[d,u]=(0,r.useState)(a.avatar?"".concat("https://d5ffe0dc8ad8.ngrok-free.app","/api/upload/").concat(a.avatar):null),[p,f]=(0,r.useState)(void 0),[h,g]=(0,r.useState)(a.background?"".concat("https://d5ffe0dc8ad8.ngrok-free.app","/api/upload/").concat(a.background):null),[b,m]=(0,r.useState)(void 0),[x,y]=(0,r.useState)(!1),[w,C]=(0,r.useState)(null),[S,T]=(0,r.useState)("avatar"),N=(0,$.Qc)(),F=(0,$.cM)();return(0,i.jsxs)(A.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(v.A,{children:"Edit Profile"}),(0,i.jsxs)(j.A,{sx:{pt:2},children:[(0,i.jsxs)(l.A,{direction:"column",alignItems:"center",spacing:1,sx:{mb:3},children:[(0,i.jsx)(Y.A,{src:h||w||"/banner-default.png",variant:"square",sx:{width:"100%",height:180}},h||w),(0,i.jsxs)(c.A,{component:"label",variant:"outlined",children:["Change Banner",(0,i.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];n&&(C(URL.createObjectURL(n)),T("background"),y(!0))}})]})]}),(0,i.jsxs)(l.A,{direction:"column",alignItems:"center",spacing:1,sx:{mb:3},children:[(0,i.jsx)(Y.A,{src:d||w||"/avatar-default.png",sx:{width:110,height:110}},d||w),(0,i.jsxs)(c.A,{component:"label",variant:"outlined",children:["Change Avatar",(0,i.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];n&&(C(URL.createObjectURL(n)),T("avatar"),y(!0))}})]})]}),(0,i.jsx)(k.A,{label:"Full Name",fullWidth:!0,sx:{mt:2},...o("fullName")}),(0,i.jsx)(k.A,{label:"Username",fullWidth:!0,sx:{mt:2},...o("userName")}),(0,i.jsx)(k.A,{label:"Bio",fullWidth:!0,multiline:!0,rows:4,sx:{mt:2},...o("bio")})]}),(0,i.jsxs)(I.A,{sx:{px:3,pb:2},children:[(0,i.jsx)(c.A,{onClick:n,children:"Cancel"}),(0,i.jsx)(c.A,{variant:"contained",onClick:s(e=>{b&&F.mutate({image:b},{onSuccess:()=>n()}),(p||e.fullName||e.userName||e.bio)&&N.mutate({...e,avatar:p},{onSuccess:()=>n()})}),disabled:N.isPending,children:"Save"})]}),x&&w&&(0,i.jsx)(ee.A,{open:x,onClose:()=>y(!1),image:w,onCropDone:e=>{"avatar"===S?(f(e),u(URL.createObjectURL(e))):(m(e),g(URL.createObjectURL(e))),y(!1)},type:S})]})}var en=n(65836),ei=n(70539),er=n(24508),ea=n(24627);let eo=e=>{if(null==e)return 0;if("number"==typeof e)return e;if("string"==typeof e){let t=Number(e.trim());return isNaN(t)?0:t}return 0},el=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{ownedList:e.filter((e,n)=>{var i;return!(null!=(i=t[n])?i:[]).some(e=>"Mint"===e.evenType)&&0===eo(e.tokenId)}),createdList:e.filter((e,n)=>{var i;return(null!=(i=t[n])?i:[]).some(e=>"Mint"===e.evenType)||eo(e.tokenId)>0})}},es=e=>{let{ownedProducts:t,allActivities:n,activitiesLoading:r,walletMode:s,handleOpenEdit:p,openSellModal:f}=e,{ownedList:h}=el(t,n);return(0,i.jsx)(u.A,{container:!0,spacing:3,mb:3,children:h.map(e=>{var h,g;let b=null!=(h=n[t.findIndex(t=>t.id===e.id)])?h:[],m=e.isFreeze;return(0,i.jsx)(u.A,{size:{xs:12,sm:6,md:4},children:(0,i.jsxs)(ei.A,{sx:{bgcolor:"rgba(255,255,255,0.03)",borderRadius:3,position:"relative",transition:"all 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 8px 24px rgba(0,0,0,0.4)"}},children:[(0,i.jsx)(er.A,{component:"img",image:"https://gateway.pinata.cloud/ipfs/".concat(e.image),alt:e.name,sx:{height:280,objectFit:"cover",borderTopLeftRadius:12,borderTopRightRadius:12}}),(0,i.jsxs)(ea.A,{sx:{bgcolor:"#1a1a2e"},children:[(0,i.jsx)(l.A,{direction:"row",justifyContent:"space-between",children:(0,i.jsx)(o.A,{variant:"subtitle1",sx:{color:"#fff",fontWeight:700,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name})}),r?(0,i.jsx)(a.A,{size:16,sx:{mt:1}}):(0,i.jsx)(l.A,{direction:"row",spacing:1,sx:{mt:1},children:m&&(0,i.jsx)(d.A,{title:"Metadata sản phẩm đ\xe3 bị kh\xf3a (freeze)",children:(0,i.jsx)(C.A,{label:"Frozen",size:"small",sx:{bgcolor:"rgba(135,206,250,0.15)",color:"#1E90FF",fontWeight:600}})})}),(0,i.jsxs)(o.A,{sx:{color:"#b78eff",mt:1},children:["Gi\xe1: ",null!=(g=e.price)?g:"N/A"]}),s&&(0,i.jsxs)(l.A,{direction:"row",spacing:1,sx:{mt:1},children:[(0,i.jsx)(c.A,{size:"small",variant:"outlined",sx:{borderColor:"#7a3bff",color:"#b78eff"},onClick:()=>p(e,b),children:"Mint"}),(0,i.jsx)(c.A,{size:"small",variant:"outlined",sx:{borderColor:"#ff7a3b",color:"#ffb78e"},onClick:()=>f(e),children:"Sell"})]})]})]})},e.id)})})};var ec=n(52619),ed=n.n(ec);let eu=e=>{let{ownedProducts:t,allActivities:n,activitiesLoading:a,walletMode:d,handleOpenEdit:p,openSellModal:f}=e,[h,g]=(0,r.useState)([]),[b,m]=(0,r.useState)(!1),[x,y]=(0,r.useState)("0");(0,r.useEffect)(()=>{(async()=>{try{let{soldProducts:e}=await (0,w.NO)();g(e||[])}catch(e){console.error("Failed to fetch sold products",e)}})()},[]);let A=[...t.filter(e=>null!==e.tokenId&&Number(e.tokenId)>0),...h.filter(e=>!t.some(t=>t.id===e.id))];(0,r.useEffect)(()=>{(async()=>{if(window.ethereum)try{let e=new T.k(window.ethereum),t=await e.getSigner(),n=(0,V.PF)(t),i=await t.getAddress(),r=await n.pendingWithdrawals(i);y(P.ck(r))}catch(e){console.error("Failed to fetch pending ETH",e),y("0")}})()},[A]);let v=async()=>{try{if(!window.ethereum)throw Error("MetaMask is not installed");m(!0);let e=new T.k(window.ethereum),t=await e.getSigner(),n=(0,V.PF)(t);S.oR.loading("Withdrawing ".concat(x," ETH..."));let i=await n.withdraw();await i.wait(),S.oR.dismiss(),S.oR.success("Successfully withdrawn ".concat(x," ETH")),y("0")}catch(e){S.oR.error("Withdraw failed: ".concat(e.message))}finally{m(!1)}};return(0,i.jsxs)(u.A,{container:!0,spacing:3,mb:3,children:[A.map(e=>{var r,a;let g=null!=(r=n[t.findIndex(t=>t.id===e.id)])?r:[],b=e.isFreeze,m=!1;return m=void 0===e.totalInstock||0===Number(e.totalInstock)||h.some(t=>t.id===e.id),(0,i.jsx)(u.A,{size:{xs:12,sm:6,md:3},children:(0,i.jsxs)(ei.A,{sx:{position:"relative",cursor:"pointer"},children:[m&&(0,i.jsx)(s.default,{sx:{position:"absolute",top:10,left:10,background:"linear-gradient(90deg,#ff3b3b,#c40000)",color:"#fff",px:1.5,py:.5,borderRadius:1,fontSize:12,fontWeight:"bold"},children:"SOLD"}),(0,i.jsxs)(ed(),{href:"/marketplace/".concat(e.id),style:{textDecoration:"none"},children:[(0,i.jsx)(er.A,{component:"img",image:"https://gateway.pinata.cloud/ipfs/".concat(e.image),alt:e.name,sx:{height:280,objectFit:"cover",borderTopLeftRadius:12,borderTopRightRadius:12}}),(0,i.jsxs)(ea.A,{sx:{bgcolor:"#1a1a2e"},children:[(0,i.jsx)(l.A,{direction:"row",justifyContent:"space-between",children:(0,i.jsx)(o.A,{variant:"subtitle1",sx:{color:"#fff",fontWeight:700},children:e.name})}),(0,i.jsxs)(l.A,{direction:"row",spacing:1,sx:{mt:1},children:[(0,i.jsx)(C.A,{label:"Minted",size:"small",sx:{bgcolor:"rgba(0,255,127,0.15)",color:"#00FA9A"}}),b&&(0,i.jsx)(C.A,{label:"Frozen",size:"small",sx:{bgcolor:"rgba(135,206,250,0.15)",color:"#1E90FF"}})]}),(0,i.jsxs)(o.A,{sx:{color:"#b78eff",mt:1},children:["Gi\xe1: ",null!=(a=e.price)?a:"N/A"]})]})]}),d&&void 0!==e.totalInstock&&(0,i.jsxs)(l.A,{direction:"row",spacing:1,sx:{px:2,bgcolor:"#1a1a2e",mt:-1.4,pb:2},children:[(0,i.jsx)(c.A,{size:"small",variant:"contained",onClick:()=>f(e),children:"Sell"}),(0,i.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>p(e,g),children:"Update"})]})]})},e.id)}),d&&Number(x)>0&&(0,i.jsx)(s.default,{mt:3,width:"100%",display:"flex",justifyContent:"center",children:(0,i.jsx)(c.A,{variant:"contained",color:"warning",onClick:v,disabled:b,children:b?"Đang r\xfat...":"Withdraw ".concat(x," ETH")})})]})};var ep=n(67909),ef=n(46074),eh=n(24288),eg=n(25789),eb=n(33868),em=n(86596),ex=n(63951),ey=n(53455),ew=n(99776),eA=n(80549),ev=n(95125),ej=n(72378);let ek="https://d5ffe0dc8ad8.ngrok-free.app/api",eC={"ngrok-skip-browser-warning":"true"},eI=()=>ej.A.get("accessToken")||"",eS={createCollection:e=>{let t=new FormData;return t.append("name",e.name),t.append("description",e.description),t.append("image",e.image),ev.A.post("".concat(ek,"/collection"),t,{headers:{...eC,Authorization:"Bearer ".concat(eI()),"Content-Type":"multipart/form-data"}})},updateCollection:e=>{let t=new FormData;return t.append("id",e.id.toString()),t.append("name",e.name),t.append("description",e.description),t.append("image",e.image),ev.A.put("".concat(ek,"/collection"),t,{headers:{...eC,Authorization:"Bearer ".concat(eI()),"Content-Type":"multipart/form-data"}})},updateCollectionVisibility:e=>ev.A.put("".concat(ek,"/collection/visibility"),e,{headers:{...eC,Authorization:"Bearer ".concat(eI())}}),deleteCollection:e=>ev.A.delete("".concat(ek,"/collection/").concat(e),{headers:{...eC,Authorization:"Bearer ".concat(eI())}}),updateProductCollection:e=>ev.A.put("".concat(ek,"/collection/product-collection"),e,{headers:{...eC,Authorization:"Bearer ".concat(eI())}}),getAllOwnedCollections:()=>ev.A.get("".concat(ek,"/collection/get-all-owned"),{headers:{...eC,Authorization:"Bearer ".concat(eI())}})},eT=(0,ep.default)(()=>n.e(3790).then(n.bind(n,93790)),{loadableGenerated:{webpack:()=>[93790]},ssr:!1}),eN=(0,ep.default)(()=>Promise.all([n.e(3664),n.e(5186)]).then(n.bind(n,45186)),{loadableGenerated:{webpack:()=>[45186]},ssr:!1}),eF=(0,ep.default)(()=>n.e(283).then(n.bind(n,50283)),{loadableGenerated:{webpack:()=>[50283]},ssr:!1}),eM=(0,ep.default)(()=>Promise.all([n.e(9428),n.e(8751),n.e(3664),n.e(3775)]).then(n.bind(n,63775)),{loadableGenerated:{webpack:()=>[63775]},ssr:!1}),eR=r.memo(e=>{let{src:t,alt:n}=e;return(0,i.jsx)(s.default,{component:"img",src:t||"/placeholder-rect.jpg",alt:n,loading:"lazy",sx:{width:"100%",height:"100%",objectFit:"cover",display:"block"}})});eR.displayName="CollectionImage";let eE=r.memo(e=>{let{collection:t,onOpenView:n,onEdit:r}=e,a=t.image?"https://res.cloudinary.com/dr6cnnvma/image/upload/v1763461854/".concat(t.image,".png"):null;return(0,i.jsxs)(ei.A,{sx:{height:220,borderRadius:3,overflow:"hidden",bgcolor:"#1a1a1a",cursor:"pointer",position:"relative",transition:"0.25s","&:hover":{transform:"scale(1.02)"}},onClick:()=>n(t),children:[a&&(0,i.jsx)(eR,{src:a,alt:t.name}),(0,i.jsx)(s.default,{sx:{position:"absolute",bottom:0,width:"100%",p:1.5,background:"linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.0))"},children:(0,i.jsx)(o.A,{variant:"h6",sx:{color:"#fff",fontWeight:700},children:t.name})}),(0,i.jsx)(eh.A,{sx:{position:"absolute",top:8,right:8,color:"#fff",bgcolor:"rgba(0,0,0,0.4)"},onClick:e=>{e.stopPropagation(),r(t)},children:(0,i.jsx)(ex.A,{})})]})});eE.displayName="CollectionCard";let eP=e=>{let{mintedProducts:t,allActivities:n}=e,{data:a=[],refetch:o}=(0,ey.I)({queryKey:["collections-owned"],queryFn:async()=>(await eS.getAllOwnedCollections()).data.data}),l=(()=>{let e=(0,ew.jE)();return(0,eA.n)({mutationFn:e=>eS.createCollection(e),onSuccess:()=>{e.invalidateQueries({queryKey:["collections"]}),e.invalidateQueries({queryKey:["collections-owned"]})}})})(),c=(()=>{let e=(0,ew.jE)();return(0,eA.n)({mutationFn:e=>eS.updateCollection(e),onSuccess:()=>{e.invalidateQueries({queryKey:["collections"]}),e.invalidateQueries({queryKey:["collections-owned"]})}})})(),d=(()=>{let e=(0,ew.jE)();return(0,eA.n)({mutationFn:e=>eS.deleteCollection(e),onSuccess:()=>{e.invalidateQueries({queryKey:["collections"]}),e.invalidateQueries({queryKey:["collections-owned"]})}})})(),u=(()=>{let e=(0,ew.jE)();return(0,eA.n)({mutationFn:e=>eS.updateProductCollection(e),onSuccess:()=>{e.invalidateQueries({queryKey:["collections"]}),e.invalidateQueries({queryKey:["collections-owned"]})}})})(),p=(()=>{let e=(0,ew.jE)();return(0,eA.n)({mutationFn:e=>eS.updateCollectionVisibility(e),onSuccess:()=>{e.invalidateQueries({queryKey:["collections"]}),e.invalidateQueries({queryKey:["collections-owned"]})}})})(),[f,h]=(0,r.useState)(!1),[g,b]=(0,r.useState)({open:!1}),[m,x]=(0,r.useState)({open:!1}),[y,w]=(0,r.useState)({open:!1}),A=(0,eg.A)(),v=(0,eb.A)(A.breakpoints.up("md")),j=(0,eb.A)(A.breakpoints.up("sm")),k=v?3:j?2:1,C=(0,r.useRef)(null),[I,S]=(0,r.useState)(800);(0,r.useEffect)(()=>{if(!C.current)return;let e=()=>S(C.current.clientWidth);e();let t=new ResizeObserver(e);return t.observe(C.current),()=>t.disconnect()},[]);let T=(0,r.useMemo)(()=>{let e=[{create:!0},...a],t=[];for(let n=0;n<e.length;n+=k)t.push(e.slice(n,n+k));return t},[a,k]),N=T.length,F=(0,r.useMemo)(()=>Math.floor((I-5*(k-1))/k),[I,k]),M=(0,r.useRef)(null),R=(0,ef.Te)({count:N,getScrollElement:()=>M.current,estimateSize:()=>240,overscan:5}),E=(0,r.useCallback)(e=>x({open:!0,collection:e}),[]),P=(0,r.useCallback)(e=>b({open:!0,collection:e}),[]);return(0,i.jsxs)(s.default,{ref:C,sx:{width:"100%",height:"auto",mb:4},children:[(0,i.jsx)(s.default,{ref:M,sx:{overflowY:"auto",height:"100%",position:"relative"},children:(0,i.jsx)(s.default,{sx:{height:R.getTotalSize(),width:"100%",position:"relative"},children:R.getVirtualItems().map(e=>{let t=T[e.index];return(0,i.jsx)(s.default,{sx:{position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(e.start,"px)"),padding:"".concat(2.5,"px 0")},children:(0,i.jsxs)(s.default,{sx:{display:"flex",gap:5},children:[t.map((t,n)=>"create"in t?(0,i.jsx)(s.default,{sx:{width:F},children:(0,i.jsx)(ei.A,{sx:{height:220,bgcolor:"rgba(255,255,255,0.05)",border:"2px dashed #6f42c1",borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"0.25s","&:hover":{bgcolor:"rgba(255,255,255,0.1)",transform:"scale(1.02)"}},onClick:()=>h(!0),children:(0,i.jsx)(em.A,{sx:{color:"#ccc",fontSize:50}})})},"create-".concat(e.index,"-").concat(n)):(0,i.jsx)(s.default,{sx:{width:F},children:(0,i.jsx)(eE,{collection:t,onOpenView:E,onEdit:P})},"col-".concat(t.id,"-").concat(e.index,"-").concat(n))),t.length<k&&Array.from({length:k-t.length}).map((e,t)=>(0,i.jsx)(s.default,{sx:{width:F}},"empty-".concat(t)))]})},e.key)})})}),f&&(0,i.jsx)(eT,{open:f,onClose:()=>h(!1),onSubmit:e=>l.mutate(e,{onSuccess:()=>{o(),h(!1)}})}),g.open&&g.collection&&(0,i.jsx)(eN,{open:g.open,collection:g.collection,onClose:()=>b({open:!1}),onSubmit:e=>c.mutate(e,{onSuccess:()=>{o(),b({open:!1})}}),onDelete:()=>d.mutate(g.collection.id,{onSuccess:()=>{o(),b({open:!1})}}),onTogglePublic:e=>p.mutate({id:g.collection.id,isPublic:e})}),m.open&&m.collection&&(0,i.jsx)(eF,{open:m.open,collection:m.collection,onClose:()=>x({open:!1}),onAddProducts:()=>w({open:!0,collection:m.collection}),onRemoveProduct:e=>u.mutate({collectionId:m.collection.id,productIds:[e],type:"remove"},{onSuccess:()=>{o()}})}),y.open&&y.collection&&(0,i.jsx)(eM,{open:y.open,collection:y.collection,products:t,allActivities:n,onClose:()=>w({open:!1}),onAdd:e=>u.mutate({collectionId:y.collection.id,productIds:e,type:"add"},{onSuccess:()=>{o(),w({open:!1})}})})]})},eO=e=>{var t;let{onBack:n,isWalletMode:A}=e,[v,j]=(0,r.useState)(0),[k,C]=(0,r.useState)(!1),[I,T]=(0,r.useState)(null),[N,F]=(0,r.useState)(!1),[M,R]=(0,r.useState)(!1),[E,P]=(0,r.useState)(null),[O,L]=(0,r.useState)("0"),[U,W]=(0,r.useState)(!1),z=(0,m.useRouter)(),_=ej.A.get("user"),D=!1;if(_)try{let e=JSON.parse(_);D=((null==e?void 0:e.permissions)||[]).some(e=>"collaborator"===e.type&&e.isActive)}catch(e){console.error("Failed to parse user cookie",e)}let q=(0,m.useSearchParams)(),K=null!=A?A:(null==q?void 0:q.get("walletMode"))==="true",{data:Q,isLoading:G,isError:H,refetch:V}=(0,x.Fu)(),{data:J,isLoading:Y,isError:ee}=(0,$.sb)(),ei=Array.isArray(Q)?Q:[],er=(0,y.E)({queries:ei.map(e=>({queryKey:["productActivity",e.id],queryFn:()=>w.fc(e.id)}))}),ea=er.map(e=>{var t,n;return null!=(n=null==(t=e.data)?void 0:t.map(e=>{var t;return{...e,eventType:null!=(t=e.evenType)?t:e.evenType}}))?n:[]}),eo=er.some(e=>e.isLoading),el=(e,t)=>{let n=Array.isArray(e.properties)?e.properties:JSON.parse(e.properties||"[]"),i={...e,properties:n.map(e=>({type:e.type||"",name:e.name||""})),isFreeze:!!e.isFreeze,externalLink:e.externalLink||""},r=t.some(e=>"Mint"===e.evenType);T(i),C(!0),F(r)};if(!J)return null;let ec=[{label:"TOTAL REVENUE",value:(null!=(t=J.ownedProducts)?t:[]).reduce((e,t)=>e+Number(t.price||0),0)},{label:"FOLLOWERS",value:J.followCount},{label:"NUMBER OF WORKS",value:J.ownedProducts.length},{label:"FLOOR PRICE",value:J.ownedProducts.length?Math.min(...J.ownedProducts.map(e=>Number(e.price||0))):0}];return G||Y?(0,i.jsx)(a.A,{}):H||ee||!J?(0,i.jsx)(o.A,{children:"User not found"}):(0,i.jsxs)(l.A,{position:"relative",sx:{overflow:"hidden",minHeight:"100vh"},children:[(0,i.jsx)(s.default,{sx:{position:"absolute",inset:0,background:"linear-gradient(120deg,#12192b,#182858,#341a57)",overflow:"hidden",zIndex:1,mt:37.5,borderTopLeftRadius:15,borderTopRightRadius:15}}),(0,i.jsxs)(s.default,{sx:{position:"relative",width:"100%",color:"#fff"},children:[(0,i.jsx)(s.default,{sx:{width:"100%",height:320,backgroundSize:"cover",backgroundPosition:"center",filter:"brightness(0.6)",zIndex:12},children:(0,i.jsx)(en.A,{type:"banner",src:J.background?"".concat("https://d5ffe0dc8ad8.ngrok-free.app","/api/upload/").concat(J.background):null})}),(0,i.jsxs)(c.A,{onClick:n,sx:{position:"absolute",top:20,left:20,background:"rgba(0,0,0,0.4)",color:"#fff",textTransform:"none",borderRadius:2,zIndex:14,"&:hover":{background:"rgba(0,0,0,0.6)"}},children:[(0,i.jsx)(h.A,{fontSize:"small",sx:{mr:1}})," Quay lại"]}),(0,i.jsxs)(s.default,{sx:{px:6,mt:-10,position:"relative",zIndex:14},children:[(0,i.jsxs)(l.A,{direction:"row",spacing:4,alignItems:"flex-start",sx:{mt:-8,px:7,position:"relative"},children:[(0,i.jsx)(en.A,{type:"avatar",src:J.avatar?"".concat("https://d5ffe0dc8ad8.ngrok-free.app","/api/upload/").concat(J.avatar):null,size:120}),(0,i.jsxs)(s.default,{children:[(0,i.jsx)(o.A,{variant:"h5",sx:{fontWeight:800,color:"#fff"},children:J.fullName}),(0,i.jsxs)(l.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(o.A,{sx:{color:"#A0A0C0",fontSize:"1rem"},children:(e=>e?e.slice(0,6)+"..."+e.slice(-4):"")(J.addressWallet)}),(0,i.jsx)(d.A,{title:"Copy Wallet Address",children:(0,i.jsx)(Z.A,{sx:{fontSize:15,color:"#A0A0C0",cursor:"pointer","&:hover":{color:"#fff"}},onClick:()=>navigator.clipboard.writeText(J.addressWallet)})})]}),(0,i.jsxs)(l.A,{direction:"row",spacing:2,sx:{mt:3},children:[D&&(0,i.jsx)(c.A,{variant:"contained",sx:{textTransform:"none",background:"linear-gradient(90deg,#7a3bff,#b78eff)"},onClick:()=>z.push("/view/news/create"),children:"Tạo News"}),(0,i.jsx)(c.A,{variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.1)",textTransform:"none",color:"#fff"},children:"Chia sẻ"}),(0,i.jsx)(c.A,{variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.1)",textTransform:"none",color:"#fff"},onClick:()=>W(!0),children:"Chỉnh sửa Profile"}),(0,i.jsxs)(l.A,{direction:"row",spacing:1,sx:{mt:1},children:[(0,i.jsx)(g.A,{sx:{color:"#cfcfff",cursor:"pointer"}}),(0,i.jsx)(b.A,{sx:{color:"#cfcfff",cursor:"pointer"}})]})]}),(0,i.jsx)(o.A,{sx:{color:"#CFCFFF",my:5,maxWidth:800,ml:-25},children:J.bio||"No bio yet."})]})]}),(0,i.jsx)(u.A,{container:!0,spacing:4,sx:{mt:6,mb:4},children:ec.map(e=>(0,i.jsxs)(u.A,{size:{xs:6,md:3},children:[(0,i.jsx)(o.A,{sx:{fontSize:24,fontWeight:700},children:e.value}),(0,i.jsx)(o.A,{sx:{color:"#9b9bbf",fontSize:14},children:e.label})]},e.label))}),(0,i.jsx)(s.default,{sx:{textAlign:"center",mb:3},children:(0,i.jsx)(c.A,{variant:"text",onClick:()=>{var e,t,n,i,r,a,o;let l=[{label:"TOTAL REVENUE",value:null!=(i=null==J||null==(e=J.ownedProducts)?void 0:e.reduce((e,t)=>e+Number(t.price||0),0))?i:0},{label:"FOLLOWERS",value:null!=(r=null==J?void 0:J.followCount)?r:0},{label:"NUMBER OF WORKS",value:null!=(a=null==J||null==(t=J.ownedProducts)?void 0:t.length)?a:0},{label:"FLOOR PRICE",value:(null==J||null==(n=J.ownedProducts)?void 0:n.length)?Math.min(...J.ownedProducts.map(e=>Number(e.price||0))):0}],s=encodeURI("data:text/csv;charset=utf-8,"+["Name,Total Revenue,Followers,Number of Works,Floor Price",[null!=(o=null==J?void 0:J.fullName)?o:"",l[0].value,l[1].value,l[2].value,l[3].value].join(",")].join("\n")),c=document.createElement("a");c.href=s,c.download="creator_stats.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c)},sx:{textTransform:"none",color:"#fff","&:hover":{color:"#b78eff"}},children:"Xuất sang Trang t\xednh"})}),(0,i.jsxs)(s.default,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,i.jsxs)(p.A,{value:v,onChange:(e,t)=>j(t),textColor:"secondary",indicatorColor:"secondary",sx:{flex:1,"& .MuiTab-root":{textTransform:"none",fontWeight:600,color:"rgba(255,255,255,0.7)"},"& .Mui-selected":{color:"secondary.main"}},children:[(0,i.jsx)(f.A,{label:"Đ\xe3 tạo"}),(0,i.jsx)(f.A,{label:"Sở hữu"}),(0,i.jsx)(f.A,{label:"Bộ sưu tập"}),(0,i.jsx)(f.A,{label:"Y\xeau th\xedch"})]}),(0,i.jsx)(c.A,{variant:"contained",sx:{ml:2},onClick:()=>{z.push("/upload")},children:"Tải th\xeam"})]}),0===v&&(0,i.jsx)(eu,{ownedProducts:null!=Q?Q:[],allActivities:ea,activitiesLoading:eo,walletMode:K,handleOpenEdit:el,openSellModal:e=>{var t;if(!e.tokenId)return void S.Ay.error("NFT chưa mint, kh\xf4ng thể b\xe1n!");P(Number(e.tokenId)),L((null==(t=e.price)?void 0:t.toString())||"0"),R(!0)}}),1===v&&(0,i.jsx)(es,{ownedProducts:null!=Q?Q:[],allActivities:ea,activitiesLoading:eo,walletMode:K,handleOpenEdit:el,openSellModal:e=>{if(!e.tokenId)return void S.Ay.error("NFT chưa mint, kh\xf4ng thể b\xe1n!");P(parseInt(e.tokenId,10)),L(e.price||"0"),R(!0)}}),2===v&&(0,i.jsx)(eP,{mintedProducts:null!=Q?Q:[],allActivities:ea})]})]}),I&&(0,i.jsx)(B,{open:k,onClose:()=>C(!1),product:I,onUpdate:V,isMinted:N}),null!==E&&(0,i.jsx)(X,{open:M,onClose:()=>R(!1),tokenId:E,defaultPrice:O}),U&&J&&(0,i.jsx)(et,{open:U,onClose:()=>W(!1),user:J})]})}},65836:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(95155),r=n(12115),a=n(41574),o=n(86627),l=n(15239);let s=r.memo(e=>{let{src:t,type:n="banner",alt:s="User",size:c=120}=e,[d,u]=(0,r.useState)(!1),p="banner"===n?"/banner-default.png":"/avatar-default.png",f=(0,r.useMemo)(()=>{if(!d&&t){let e="/api/proxy-image?url=".concat(encodeURIComponent(t));return"banner"===n?"".concat(e,"&banner=true"):e}return p},[d,t,n,p]);return"banner"===n?(0,i.jsx)(a.default,{sx:{width:"100%",height:320,backgroundImage:"url(".concat(f,")"),backgroundSize:"cover",backgroundPosition:"center",filter:"brightness(0.95)"},children:t&&!d&&(0,i.jsx)(l.default,{src:f,alt:s,width:1e3,height:320,style:{display:"none"},onError:()=>u(!0),loading:"lazy"})}):(0,i.jsx)(o.A,{src:f,alt:s,sx:{width:c,height:c,border:"5px solid rgba(255,255,255,0.2)",boxShadow:"0 4px 25px rgba(0,0,0,0.5)"},onError:()=>u(!0)})})},74612:(e,t,n)=>{n.d(t,{A:()=>b});var i=n(95155),r=n(12115),a=n(75265),o=n(2021),l=n(99496),s=n(41574),c=n(41942),d=n(80317),u=n(27782),p=n(66370),f=n(27855),h=n(48704);async function g(e,t,n){var i;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=await (i=e,new Promise((e,t)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>e(n),n.onerror=e=>t(e),n.src=i})),o=document.createElement("canvas");o.width=t.width,o.height=t.height;let l=o.getContext("2d");if(!l)throw Error("Cannot get canvas context");return l.translate(o.width/2,o.height/2),l.rotate(r*Math.PI/180),l.translate(-o.width/2,-o.height/2),l.drawImage(a,t.x,t.y,t.width,t.height,0,0,t.width,t.height),new Promise((e,t)=>{o.toBlob(i=>{if(!i)return t("Canvas is empty");e(new File([i],"cropped_".concat(n,".png"),{type:"image/png"}))},"image/png")})}function b(e){let{open:t,onClose:n,image:b,onCropDone:m,type:x="avatar"}=e,[y,w]=(0,r.useState)({x:0,y:0}),[A,v]=(0,r.useState)(1),[j,k]=(0,r.useState)(0),[C,I]=(0,r.useState)(null),S=(()=>{switch(x){case"avatar":default:return 1;case"background":return 3;case"rectangle":return 1.5}})(),T=(0,r.useCallback)((e,t)=>{I(t)},[]),N=(0,r.useCallback)(async()=>{if(C)try{let e=await g(b,C,x,j);m(e)}catch(e){console.error(e)}},[C,b,m,x,j]);return(0,i.jsxs)(a.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[(0,i.jsxs)(o.A,{sx:{fontWeight:700,fontSize:20,textAlign:"center"},children:["Crop ","avatar"===x?"Avatar":"background"===x?"Banner":"Rectangle"," Image"]}),(0,i.jsx)(l.A,{sx:{position:"relative",height:400,background:"#1e1e1e",borderRadius:2,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(h.Ay,{image:b,crop:y,zoom:A,rotation:j,aspect:S,onCropChange:w,onZoomChange:v,onCropComplete:T,cropShape:"avatar"===x?"round":"rect",showGrid:!0})}),(0,i.jsx)(s.default,{sx:{px:4,py:2},children:(0,i.jsxs)(c.A,{spacing:2,children:[(0,i.jsxs)(s.default,{children:[(0,i.jsx)(d.A,{variant:"body2",sx:{color:"#aaa",mb:1,textAlign:"center"},children:"Zoom"}),(0,i.jsx)(u.Ay,{min:1,max:3,step:.01,value:A,onChange:(e,t)=>v(t),sx:{"& .MuiSlider-thumb":{bgcolor:"#7a3bff",border:"2px solid #fff"},"& .MuiSlider-track":{bgcolor:"#7a3bff"},"& .MuiSlider-rail":{bgcolor:"#555"}}})]}),(0,i.jsxs)(s.default,{children:[(0,i.jsx)(d.A,{variant:"body2",sx:{color:"#aaa",mb:1,textAlign:"center"},children:"Rotation"}),(0,i.jsx)(u.Ay,{min:0,max:360,step:1,value:j,onChange:(e,t)=>k(t),sx:{"& .MuiSlider-thumb":{bgcolor:"#7a3bff",border:"2px solid #fff"},"& .MuiSlider-track":{bgcolor:"#7a3bff"},"& .MuiSlider-rail":{bgcolor:"#555"}}})]})]})}),(0,i.jsxs)(p.A,{sx:{px:4,pb:3,justifyContent:"center"},children:[(0,i.jsx)(f.A,{onClick:n,sx:{textTransform:"none",fontWeight:600,color:"#fff",bgcolor:"#333","&:hover":{bgcolor:"#444"}},children:"Cancel"}),(0,i.jsx)(f.A,{variant:"contained",onClick:N,sx:{textTransform:"none",fontWeight:700,background:"linear-gradient(135deg, #7a3bff 0%, #ff5ca2 100%)",color:"#fff",px:4,py:1.2,borderRadius:2,boxShadow:"0px 4px 12px rgba(122,59,255,0.4)","&:hover":{background:"linear-gradient(135deg, #6a2adf 0%, #ff4090 100%)",boxShadow:"0px 6px 16px rgba(122,59,255,0.6)"}},children:"Save"})]})]})}},93475:(e,t,n)=>{n.d(t,{PF:()=>d,v_:()=>u});var i=n(51012),r=n(16836),a=n(43338),o=n(99794),l=n(95704);let s="0xe76b09274f7b6681A65975449F9aB3175dd17E51";s||console.warn("⚠️ Thiếu biến NEXT_PUBLIC_MARKETPLACE_ADDRESS trong .env.local");let c=["function listItem(address nftAddress,uint256 tokenId,uint256 price) public returns (uint256)","function cancelListing(uint256 listingId) public","function updateListingPrice(uint256 listingId,uint256 newPrice) public","function buyItem(uint256 listingId) public payable","function createAuction(address nftAddress,uint256 tokenId,uint256 minPrice,uint256 durationSeconds) public returns (uint256)","function placeBid(uint256 auctionId) public payable","function finalizeAuction(uint256 auctionId) public","function cancelAuction(uint256 auctionId) public","function withdraw() public","function pendingWithdrawals(address user) public view returns (uint256)","function getListing(uint256 listingId) public view returns (tuple(address seller,address nftAddress,uint256 tokenId,uint256 price,bool active))","function getAuction(uint256 auctionId) public view returns (tuple(address seller,address nftAddress,uint256 tokenId,uint256 minPrice,uint256 highestBid,address highestBidder,uint256 startTime,uint256 endTime,bool settled))"];function d(e){let t=null!=e?e:window.ethereum?new i.k(window.ethereum):new r.FR(l.env.NEXT_PUBLIC_RPC_URL||"https://rpc.zerochain.network");return new a.NZ(s,c,t)}let u={listItem:async(e,t,n,i)=>{let r=d().connect(e);return(await r.listItem(t,n,(0,o.g5)(i.toString()))).wait()},cancelListing:async(e,t)=>{let n=d().connect(e);return(await n.cancelListing(t)).wait()},updateListingPrice:async(e,t,n)=>{let i=d().connect(e);return(await i.updateListingPrice(t,(0,o.g5)(n.toString()))).wait()},buyItem:async(e,t,n)=>{let i=d().connect(e),r=await i.buyItem(t,{value:n});return await r.wait(),r},createAuction:async(e,t,n,i,r)=>{let a=d().connect(e);return(await a.createAuction(t,n,(0,o.g5)(i.toString()),r)).wait()},placeBid:async(e,t,n)=>{let i=d().connect(e);return(await i.placeBid(t,{value:n})).wait()},finalizeAuction:async(e,t)=>{let n=d().connect(e);return(await n.finalizeAuction(t)).wait()},cancelAuction:async(e,t)=>{let n=d().connect(e);return(await n.cancelAuction(t)).wait()},withdraw:async e=>{let t=d().connect(e);return(await t.withdraw()).wait()},getListing:async e=>{let t=d(),n=await t.getListing(e);return{seller:n.seller,nftAddress:n.nftAddress,tokenId:n.tokenId,price:n.price,active:n.active}},getAuction:async e=>{let t=d(),n=await t.getAuction(e);return{seller:n.seller,nftAddress:n.nftAddress,tokenId:n.tokenId,minPrice:n.minPrice,highestBid:n.highestBid,highestBidder:n.highestBidder,startTime:n.startTime,endTime:n.endTime,settled:n.settled}}}}}]);